\documentclass[titlepage, a4paper]{article}
\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage{color}
\usepackage{mathtools}
\usepackage{float}
\usepackage[parfill]{parskip}
\usepackage[margin=10pt,font=small,labelfont=bf,labelsep=endash]{caption}
\usepackage{epstopdf}
\usepackage{listings}
\usepackage[table]{xcolor}
\usepackage{tabularx}
\epstopdfsetup{suffix=}
\DeclareGraphicsExtensions{.ps}
\DeclareGraphicsRule{.ps}{pdf}{.pdf}{`ps2pdf -dEPSCrop -dNOSAFER #1 \noexpand\OutputFile}
\usepackage{tikz}
\usetikzlibrary{arrows}

\definecolor{green}{rgb}{56,90,115}

\lstset{literate=%
    {å}{{\r{a}}}1
    {ä}{{\"a}}1
    {ö}{{\"o}}1
    {Å}{{\r{A}}}1
    {Ä}{{\"A}}1
    {Ö}{{\"O}}1
}

\newcommand{\todo}[1] {\textbf{\textcolor{red}{#1}}}

\usepackage{fancyhdr}
\fancyhead[L]{}
\pagestyle{fancy}
\rhead{Alexander Yngve \\ Pål Kastman}
\chead{TDTS08}
\thispagestyle{empty}

\begin{document}

{\ }\vspace{45mm}

\begin{center}
  \Huge \textbf{TDTS08: Lab Report}
\end{center}
\begin{center}
  \Large Lab 4: VLIW Processors
\end{center}

\vspace{250pt}

\begin{center}
  \begin{tabular}{|*{3}{p{40mm}|}}
    \hline
    \textbf{Name} & \textbf{PIN} & \textbf{Email} \\ \hline
           {Alexander Yngve} & {930320-6651} & {aleyn573@student.liu.se} \\ \hline
           {Pål Kastman} & {851212-7575} & {palka285@student.liu.se} \\ \hline
  \end{tabular}
\end{center}
\newpage

\tableofcontents
\thispagestyle{empty}
\newpage

\section{Introduction}\label{sec:intro}
The purpose of this lab was to convert normal sequential code to VLIW instructions, so that we would get a greater performance. Basically we do what the VLIW compiler does during compilation time.
\section{Method}
The approach for this lab was the following:

\begin{enumerate}
\item Choose a basic block, and disassemble the block. 
\item Find dependencies between the instruction in the block.
\item We pack the instruction into VLIWs.  
\end{enumerate}

\subsection{Basic Block}\label{sec:bb}
To view all the basic blocks within the program (go.ss) the following command is issued:

\begin{lstlisting}
vliwc /home/TDTS08/bin/go.ss | sort -nr +3 -4 | less
\end{lstlisting}

A basic block with at least 15 instructions is needed for the lab.

The next step is to view the disassemble the program to view the code for the basic block. This is done with the command below:

\begin{lstlisting}
sslittle-na-sstrix-objdump -d /home/TDTS08/bin/go.ss | less
\end{lstlisting}

Which gives output similiar to this:

\begin{lstlisting}
  41b528:       28 00 00 00     lw $3,16($29)
  41b52c:       10 00 03 1d 
  41b530:       28 00 00 00     lw $4,-31444($28)
  41b534:       2c 85 04 1c 
  41b538:       a2 00 00 00     lui $6,4100
  41b53c:       04 10 06 00 
  41b540:       43 00 00 00     addiu $6,$6,-6208
  41b544:       c0 e7 06 06 
\end{lstlisting}

\subsection{Dependencies}\label{sec:dep}
To pack the instructions into Very Long Instruction Words, the dependencies between the instructions must be resolved. The dependencies of interest are the true data dependencies, read after write, where the output of one instruction is required as an input to one of the following instructions.

Output dependencies (write after write) and anti-dependencies (write after read) are not considered since the are artificial dependencies which can be resolved in preprocessing.

The true data dependencies should be visualized in a directed graph where the address of each instruction is a node. The edges between the nodes symbolizes a dependency. This graph should also be described in a textual representation which will be used by the \textit{vliwc} program. An example of the graph file looks like this:

\begin{lstlisting}
  0x00000001
  0x00000001 0x00000002
\end{lstlisting}

This file describes two instructions, \textit{0x00000001} which is independent, and \textit{0x00000002} which is dependent on \textit{0x00000001}.

\subsection{VLIW}
The last step is to pack the sequential instructions obtained in section \ref{sec:bb} into VLIW format with the help of the dependency graph from section \ref{sec:dep}.

The text format for the VLIW file begins with a line which specifies \textit{alu\_no}, \textit{mul\_no}, \textit{fpu\_no} and \textit{bau\_no} - how many ALUs, MULs, FPUs and BAUs the VLIW processor will have.

The next lines are the Very Long Instruction Words in the form of addresses to the sequential instructions. The first \textit{alu\_no} instructions will be ALU instructions, the next \textit{mul\_no} instructions will be MUL instrustions and so on.

An example VLIW file can look like this:

\begin{lstlisting}
1          1   1   2
nop        nop nop 0x0041b528 0x0041b538
0x0041b540 nop nop 0x0041b530 nop
\end{lstlisting}

\section{Result}

\begin{figure}
  \centering
  \begin{tikzpicture}
    \tikzset{vertex/.style = {shape=rectangle, draw, minimum size=1.5em}}
    \tikzset{edge/.style = {->,> = latex'}}

    \node[vertex] (41b528) at (0,6) {41b528};
    \node[vertex] (41b530) at (2,6) {41b530};
    \node[vertex] (41b538) at (4,6) {41b538};
    \node[vertex] (41b540) at (4,5) {41b540};
    \node[vertex] (41b548) at (6,6) {41b548};
    \node[vertex] (41b550) at (6,5) {41b550};
    \node[vertex] (41b558) at (8,6) {41b558};
    \node[vertex] (41b560) at (8,5) {41b560};
    \node[vertex] (41b568) at (0,5) {41b568};
    \node[vertex] (41b570) at (2,4) {41b570};
    \node[vertex] (41b578) at (2,3) {41b578};
    \node[vertex] (41b580) at (8,4) {41b580};
    \node[vertex] (41b588) at (6,4) {41b588};
    \node[vertex] (41b590) at (4,2) {41b590};
    \node[vertex] (41b598) at (4,1) {41b598};
    \node[vertex] (41b5a0) at (4,0) {41b5a0};

    \draw[edge] (41b528) to (41b568);
    \draw[edge] (41b538) to (41b540);
    \draw[edge] (41b548) to (41b550);
    \draw[edge] (41b558) to (41b560);
    \draw[edge] (41b568) to (41b570);
    \draw[edge] (41b568) to[out=0, in=270] (41b580);
    \draw[edge] (41b540) to (41b570);
    \draw[edge] (41b570) to (41b578);
    \draw[edge] (41b550) to (41b588);
    \draw[edge] (41b560) to (41b580);
    \draw[edge] (41b578) to (41b590);
    \draw[edge] (41b588) to (41b590);
    \draw[edge] (41b590) to (41b598);
  \end{tikzpicture}
  \caption{Data dependencies between the instructions.}
  \label{fig:dep}
\end{figure}

\section{Discussion}
\end{document}
